# تعليمات إصلاح مشاكل رفع الصور

## المشاكل المحلولة

### 1. إضافة حقل Category للشرائح

لإضافة حقل category، تحتاج لتشغيل الأوامر التالية:

#### الطريقة الأولى: استخدام Prisma Migration
```bash
npx prisma migrate dev --name add-category-to-hero-slider
```

#### الطريقة الثانية: تشغيل SQL مباشرة
```sql
ALTER TABLE "public"."hero_sliders" ADD COLUMN "category" TEXT;
```

### 2. إصلاح مشكلة رفع الصور في البيئات المختلفة

تم إصلاح مشكلة `ENOENT: no such file or directory, mkdir '/var/task/public'` من خلال:

#### أ) دعم البيئات المختلفة:
- **البيئة المحلية**: يستخدم `public/uploads/`
- **البيئة السحابية (Vercel/Serverless)**: يستخدم `/tmp/uploads/`

#### ب) إنشاء endpoint لخدمة الملفات:
- `/api/files/[filename]` لخدمة الملفات في البيئة السحابية
- معالجة أفضل للأخطاء مع رسائل واضحة

#### ج) تحسين معالجة الأخطاء:
- رسائل خطأ مفصلة مع اقتراحات للحلول
- logging محسن لتسهيل التشخيص

## الإصلاحات المطبقة

1. ✅ إصلاح مشكلة `getServerSession` بإضافة `authOptions`
2. ✅ إصلاح مسارات import باستخدام `@/` alias
3. ✅ دعم البيئات المحلية والسحابية لرفع الصور
4. ✅ إنشاء endpoint `/api/files/[filename]` لخدمة الملفات
5. ✅ تحسين معالجة الأخطاء مع رسائل واضحة
6. ✅ إضافة حقل category في schema
7. ✅ إضافة placeholder جميل عند عدم وجود شرائح

## اختبار الوظائف

بعد تطبيق الإصلاحات، جرب:

1. **رفع صورة جديدة** - يجب أن يعمل في البيئة المحلية والسحابية
2. **إنشاء شريحة جديدة** مع إضافة فئة اختيارية
3. **تعديل شريحة موجودة**
4. **معاينة الشرائح** في لوحة التحكم
5. **عرض الشرائح** في الصفحة الرئيسية

## استكشاف الأخطاء

إذا استمرت المشاكل:

### مشاكل رفع الصور:
- تحقق من console logs في المتصفح
- تحقق من server logs
- تأكد من صلاحيات الكتابة في مجلد المشروع

### مشاكل قاعدة البيانات:
- تحقق من اتصال قاعدة البيانات في `.env`
- تأكد من تشغيل migration
- جرب `npx prisma db push` إذا لم تعمل migration

### مشاكل البيئة السحابية:
- الملفات المرفوعة في `/tmp` مؤقتة
- فكر في استخدام خدمة تخزين خارجية مثل:
  - Cloudinary
  - AWS S3
  - Vercel Blob Storage

## التوصيات للإنتاج

للاستخدام في الإنتاج، يُنصح بـ:

1. **استخدام خدمة تخزين خارجية** مثل Cloudinary أو AWS S3
2. **تفعيل CDN** لتسريع تحميل الصور
3. **ضغط الصور** تلقائياً قبل الرفع
4. **إضافة watermark** للصور إذا لزم الأمر
